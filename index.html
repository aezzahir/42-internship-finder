<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>42 Internship Finder</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        h1 {
            color: #00babc;
            margin-bottom: 10px;
        }
        
        .search-container {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .results-container {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .offer-card {
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        
        .offer-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .offer-title {
            color: #00babc;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .offer-company {
            font-weight: 600;
            color: #444;
        }
        
        .offer-location {
            color: #666;
            margin-bottom: 10px;
        }
        
        .offer-description {
            margin-bottom: 15px;
            line-height: 1.5;
        }
        
        .offer-details {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 14px;
            color: #666;
        }
        
        .offer-detail {
            background-color: #f5f7fa;
            padding: 5px 10px;
            border-radius: 4px;
        }
        
        .apply-btn {
            margin-top: 15px;
            background-color: #00babc;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .error-message {
            background-color: #fff5f5;
            color: #e53e3e;
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 30px;
            gap: 10px;
        }
        
        .pagination button {
            background-color: white;
            color: #00babc;
            border: 1px solid #00babc;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .pagination button.active {
            background-color: #00babc;
            color: white;
        }
        
        .pagination button:disabled {
            background-color: #eee;
            color: #999;
            border-color: #ddd;
            cursor: not-allowed;
        }
        
        .status-message {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        #loginButton {
            background-color: #00babc;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            display: block;
            margin: 20px auto;
            min-width: 200px;
        }
        
        #loginButton:hover {
            background-color: #00a0a2;
        }
    </style>
</head>
<body>
    <header>
        <h1>42 Internship Finder</h1>
        <p>View available internship opportunities at 42 partner companies</p>
    </header>
    
    <main>
        <section class="results-container">
            <h2>Available Internships</h2>
            <div id="authContainer">
                <p class="status-message">Please log in with your 42 account to view available internship offers</p>
                <button id="loginButton">Login with 42</button>
            </div>
            
            <div id="errorMessage" class="error-message" style="display: none;"></div>
            <div id="loadingIndicator" class="loading" style="display: none;">
                <p>Loading internship offers...</p>
            </div>
            <div id="results"></div>
            <div id="pagination" class="pagination"></div>
        </section>
    </main>
    
    <script>
        // Configuration
        const API_BASE_URL = 'https://companies.intra.42.fr';
        const OFFER_DETAIL_ENDPOINT = '/offers/23430'; // Specific offer endpoint as provided
        const AUTH_REDIRECT_URI = window.location.href;
        
        // DOM Elements
        const resultsContainer = document.getElementById('results');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const paginationContainer = document.getElementById('pagination');
        const authContainer = document.getElementById('authContainer');
        const loginButton = document.getElementById('loginButton');
        
        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Check if user is authenticated
            if (isAuthenticated()) {
                authContainer.style.display = 'none';
                fetchOffers();
            } else {
                setupLoginButton();
                handleAuthCallback();
            }
        });
        
        function setupLoginButton() {
            loginButton.addEventListener('click', () => {
                // Redirect to 42 OAuth login
                const clientId = '42_client_id'; // Replace with your actual client ID
                const redirectUri = encodeURIComponent(AUTH_REDIRECT_URI);
                const authUrl = `https://api.intra.42.fr/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code`;
                window.location.href = authUrl;
            });
        }
        
        function handleAuthCallback() {
            // Check if the URL contains an authorization code
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (code) {
                // Exchange code for token
                showLoading(true);
                exchangeCodeForToken(code)
                    .then(token => {
                        // Save token and fetch offers
                        saveToken(token);
                        authContainer.style.display = 'none';
                        fetchOffers();
                    })
                    .catch(error => {
                        showError('Authentication failed. Please try again.');
                        console.error('Auth Error:', error);
                        showLoading(false);
                    });
            }
        }
        
        async function exchangeCodeForToken(code) {
            // In a real app, you would call your backend to exchange the code for a token
            // GitHub Pages doesn't support server-side code, so this would need to be handled by a separate backend service
            
            // Simulated token exchange - replace with actual implementation when you have a backend
            return new Promise((resolve, reject) => {
                // For demo purposes only - in production, use a real backend exchange
                // This is just to show the flow - NOT for production use
                resolve({
                    access_token: 'simulated_token',
                    expires_in: 7200
                });
            });
        }
        
        function saveToken(token) {
            localStorage.setItem('42_auth_token', token.access_token);
            localStorage.setItem('42_token_expiry', Date.now() + (token.expires_in * 1000));
        }
        
        function getToken() {
            return localStorage.getItem('42_auth_token');
        }
        
        function isTokenExpired() {
            const expiry = localStorage.getItem('42_token_expiry');
            return !expiry || parseInt(expiry) < Date.now();
        }
        
        function isAuthenticated() {
            return getToken() && !isTokenExpired();
        }
        
        function logout() {
            localStorage.removeItem('42_auth_token');
            localStorage.removeItem('42_token_expiry');
            window.location.reload();
        }
        
        // API Functions
        async function fetchOffers() {
            showLoading(true);
            clearError();
            
            try {
                // Since the specific offer ID was provided (23430)
                const offer = await fetchOfferById(23430);
                displayOffer(offer);
            } catch (error) {
                showError('Error fetching internship offers. Please try again later.');
                console.error('API Error:', error);
            } finally {
                showLoading(false);
            }
        }
        
        async function fetchOfferById(id) {
            // In a production app, this would make an actual API request
            // Since we can't make direct API calls from GitHub Pages due to CORS restrictions,
            // we'll simulate the API response structure based on the endpoint documentation
            
            // Simulated offer data structure based on API documentation
            // In production, replace this with an actual fetch call to your backend proxy
            return {
                id: 23430,
                title: "Software Engineering Internship",
                description: "Join our engineering team and work on cutting-edge technology projects. This internship offers hands-on experience with our software development lifecycle and collaboration with senior engineers.",
                company: {
                    id: 42,
                    name: "42 Technology Partners",
                    country: "France",
                    city: "Paris"
                },
                location: "Paris, France",
                duration: "6 months",
                compensation: "â‚¬1200/month",
                requirements: "- Experience with C/C++\n- Knowledge of algorithms and data structures\n- Interest in system programming",
                apply_url: "https://companies.intra.42.fr/offers/23430",
                posted_date: "2025-03-15"
            };
        }
        
        // UI Functions
        function displayOffer(offer) {
            let html = `
                <div class="offer-card">
                    <h3 class="offer-title">${offer.title}</h3>
                    <p class="offer-company">${offer.company.name}</p>
                    <p class="offer-location">${offer.location}</p>
                    <div class="offer-description">${offer.description}</div>
                    
                    <h4>Requirements</h4>
                    <div class="offer-description">${offer.requirements}</div>
                    
                    <div class="offer-details">
                        <span class="offer-detail">Duration: ${offer.duration}</span>
                        <span class="offer-detail">Posted: ${formatDate(offer.posted_date)}</span>
                        <span class="offer-detail">Compensation: ${offer.compensation}</span>
                    </div>
                    
                    <a href="${API_BASE_URL}/offers/${offer.id}" class="apply-btn" target="_blank">View Details & Apply</a>
                </div>
            `;
            
            resultsContainer.innerHTML = html;
            paginationContainer.innerHTML = ''; // No pagination needed for single offer
        }
        
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }
        
        function showLoading(isLoading) {
            loadingIndicator.style.display = isLoading ? 'block' : 'none';
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }
        
        function clearError() {
            errorMessage.textContent = '';
            errorMessage.style.display = 'none';
        }
    </script>
</body>
</html>